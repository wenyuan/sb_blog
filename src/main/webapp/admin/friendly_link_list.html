<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>博客后台管理系统</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="/static/layui/css/layui.css" media="all">
<link rel="stylesheet" type="text/css" type="text/css" href="/static/fontawesome/css/fontawesome.min.css" media="all">
<link rel="stylesheet" href="/static/admin/css/x-admin.css" media="all">
</head>
<body>
<div class="x-nav">
    <span class="layui-breadcrumb">
        <a><cite>首页</cite></a>
        <a><cite>友情链接</cite></a>
        <a><cite>友情链接管理</cite></a>
    </span>
</div>
<div class="x-body">
    <form class="layui-form x-center" action="" style="width: 70%">
        <div class="layui-form-pane" style="margin-top: 15px;">
            <div class="layui-form-item">
                <label class="layui-form-label">链接名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="linkName" placeholder="链接名" autocomplete="off" class="layui-input">
                    </div>
                <label class="layui-form-label">URL</label>
					<div class="layui-input-inline">
						<input type="text" name="linkUrl" placeholder="http://www.baidu.com" autocomplete="off" class="layui-input">
					</div>
                    <div class="layui-input-inline" style="width: 80px">
                        <button class="layui-btn" id="addLink" type="button">
                            <i class="layui-icon">&#xe608;</i>添加
                        </button>
                    </div>
            </div>
        </div>
    </form>
	<xblock>
        <button class="layui-btn layui-btn-danger" onclick="delAll()">
            <i class="layui-icon">&#xe640;</i>批量删除
        </button>
        <span class="x-right" style="line-height: 40px">共有数据：88 条</span>
    </xblock>
    <table id="link-table" lay-filter="link-table"></table>
    <script type="text/html" id="table-toolbar">
        <a title="编辑" href="javascript:;" onclick="link_edit('编辑','link-edit.html','4','','510')" class="ml-5" style="text-decoration: none">
            <i class="layui-icon">&#xe642;</i>
        </a> 
        <a title="删除" href="javascript:;" onclick="link_del(this,'1')" style="text-decoration: none">
            <i class="layui-icon">&#xe640;</i>
        </a>
    </script>

</div>
<script type="text/javascript" src="/static/jquery/jquery-3.3.1.min.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/ckeditor/ckeditor.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/admin/js/x-layui.js" charset="utf-8"></script>
<script type="text/javascript">
layui.use(['element','laypage','layer','form','table'], function(){
	var element = layui.element;    // 面包导航
    var laypage = layui.laypage;    // 分页
    var form = layui.form;    // 弹出层
    var layer = layui.layer;    // 弹出层
    var table = layui.table;    // 渲染表格
    
    table.render({
    	elem: '#link-table'
        ,url: '/admin/link/list'
        ,response: {
        	statusCode: 200
        	,countName: 'total'
        	,dataName: 'data'
        }
        ,page: true
        ,cols: [[
        	{checkbox: true, width:90}
          ,{field: 'id', title: '编号', align:'center', width:100, sort: true}
          ,{field: 'linkName', title: '链接名', align:'center'}
          ,{field: 'linkUrl', title: '链接地址', align:'center'}
          ,{field: 'orderNo', title: '排序', align:'center', width:100, sort: true} 
          ,{fixed: 'right', title: '操作', align:'center', width:200, toolbar: '#table-toolbar'}
        ]]
      });
    
    $("#addLink").click(function(){
    	var params = {}
        $('form').serializeArray().forEach(function (item) {
          params[item.name] = item.value
        });
        var htmlContent = CKEDITOR.instances.content.getData();
        params["blogTypeId"] = parseInt(params["blogTypeId"])
        params["htmlContent"] = htmlContent
        $.ajax({
            url: "/admin/blog/save",
            type: "POST",
            dataType : "JSON",
            contentType: "application/json",
            data: JSON.stringify(params),
            success: function(result) {
                if (result.success) { 
                    layer.alert("发布成功！", {icon: 6});
                    resetValue();
                } else {
                    layer.alert("发布失败！", {icon: 5});
                }
            }
        }); 
    });
    
    // 批量删除提交
    function delAll() {
    	layer.confirm('确认要删除吗？', function(index) {
            // 捉到所有被选中的，发异步进行删除
            layer.msg('删除成功', {icon : 1});
        });
    }

    // 用户-编辑
    function link_edit(title, url, id, w, h) {
    	x_admin_show(title, url, w, h);
    }

    // 删除
    function link_del(obj, id) {
    	layer.confirm('确认要删除吗？', function(index) {
            //发异步删除数据
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {icon : 1,time : 1000});
        });	
    }
 
});
</script>
</body>
</html>